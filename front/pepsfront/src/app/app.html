<!-- Affiche le contenu principal SI l'utilisateur est connecté -->
@if (isLoggedIn()) {

  <!-- Barre de Navigation -->
  <nav class="navbar">
    <div class="nav-buttons">
      <button 
        (click)="setCurrentPage('dashboard')"
        [class.active]="currentPage() === 'dashboard'">
        Dashboard
      </button>
      <button 
        (click)="setCurrentPage('interactions')"
        [class.active]="currentPage() === 'interactions'">
        Interactions
      </button>
      <button 
        (click)="setCurrentPage('modules')"
        [class.active]="currentPage() === 'modules'">
        Modules
      </button>
      <button 
        (click)="setCurrentPage('sounds')"
        [class.active]="currentPage() === 'sounds'">
        Sons
      </button>
    </div>
  </nav>

  <!-- Conteneur de Page -->
  <main class="page-container">
    
    <!-- Page: Dashboard -->
    @if (currentPage() === 'dashboard') {
      <div class="page-content">
        <h1>Dashboard - Système Interactif Aras</h1>
        
        <div class="stats-grid">
          <div class="stat-card stat-card-interactions">
            <h3>Interactions du jour</h3>
            <p class="stat-number">{{ stats().totalInteractions }}</p>
          </div>
          
          <div class="stat-card stat-card-modules">
            <h3>Modules actifs</h3>
            <p class="stat-number">{{ stats().activeModules }}</p>
          </div>
          
          <div class="stat-card stat-card-last">
            <h3>Dernière interaction</h3>
            <p class="stat-time">{{ stats().lastInteraction }}</p>
          </div>
        </div>

        <div class="chart-container">
          <h2>Utilisations du jour</h2>
          <!-- 
            REMARQUE: recharts est une bibliothèque React. 
            Pour Angular, vous utiliseriez ngx-charts ou Chart.js.
            Ceci est un placeholder.
          -->
          <div class="chart-placeholder">
            <!--[Zone du graphique - Intégrez ngx-charts ici]-->
            <div class="chart-mock">
              @for(item of dailyChartData; track item.time) {
                <div class="bar" [style.height.%]="(item.count / 30) * 100" [title]="item.time + ': ' + item.count"></div>
              }
            </div>
          </div>
        </div>

        <button class="btn btn-primary" (click)="refreshStats()">
          Rafraîchir
        </button>
      </div>
    }

    <!-- Page: Interactions -->
    @if (currentPage() === 'interactions') {
      <div class="page-content">
        <h1>Liste des Interactions</h1>
        
        <div class="filter-buttons">
          <button 
            (click)="setFilter('all')" 
            [class.active]="filter() === 'all'">
            Toutes
          </button>
          <button 
            (click)="setFilter('today')" 
            [class.active]="filter() === 'today'">
            Aujourd'hui
          </button>
          <button 
            (click)="setFilter('week')" 
            [class.active]="filter() === 'week'">
            Cette semaine
          </button>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Date/Heure</th>
                <th>Module</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody>
              @for (interaction of filteredInteractions(); track interaction.id; let even = $even) {
                <tr [class.even-row]="even">
                  <td>{{ interaction.date }}</td>
                  <td>{{ interaction.module }}</td>
                  <td>{{ interaction.type }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <button class="btn btn-secondary">
          Exporter CSV
        </button>
      </div>
    }

    <!-- Page: Modules -->
    @if (currentPage() === 'modules') {
      <div class="page-content">
        <h1>Gestion des Modules</h1>
        
        <div class="modules-grid">
          @for (module of modules(); track module.id) {
            <div class="module-card" [class.inactive]="module.status === 'Inactif'">
              <h3>{{ module.name }}</h3>
              <p><strong>Localisation:</strong> {{ module.location }}</p>
              <p><strong>Statut:</strong> 
                <span [class]="module.status === 'Actif' ? 'status-active' : 'status-inactive'">
                  {{ module.status }}
                </span>
              </p>
              <p><strong>IP:</strong> {{ module.ip }}</p>
              <div class="module-buttons">
                <button class="btn btn-primary" (click)="configureModule(module.name)">
                  Configurer
                </button>
                <button 
                  class="btn"
                  [class]="module.status === 'Actif' ? 'btn-danger' : 'btn-secondary'"
                  (click)="toggleModule(module.id)">
                  {{ module.status === 'Actif' ? 'Désactiver' : 'Activer' }}
                </button>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Page: Sons -->
    @if (currentPage() === 'sounds') {
      <div class="page-content sounds-page">
        <h1>Gestion de la bibliothèque sonore</h1>
        <p>Module en cours de développement</p>
      </div>
    }
  </main>

} @else {
  <!-- SINON, affiche le formulaire de connexion -->
  <div class="login-container">
    <form class="login-form" (submit)="checkPassword($event)">
      <h2>Connexion</h2>
      <p>Veuillez entrer le mot de passe d'accès.</p>
      
      <input 
        type="password" 
        name="password" 
        placeholder="Mot de passe" 
        required
        autocomplete="current-password"
      >
      
      @if (loginError()) {
        <p class="login-error">{{ loginError() }}</p>
      } @else {
        <p class="login-error-placeholder"></p> <!-- Pour garder la hauteur -->
      }
      
      <button type="submit" class="btn btn-primary">Entrer</button>
    </form>
  </div>
}